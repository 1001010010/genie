apply plugin: 'java'

// we are doing this rather than a dependency since we 
// must perform build-time enhancement for OpenJPA
sourceSets.main.java.srcDirs += '../genie-common/src/main/java'
//sourceSets.main.java.srcDirs += new File(project.parent.project(':genie-common').projectDir, 'src/main/java')
//sourceSets.main.java.srcDirs += project.parent.childProjects.get('genie-common').sourceSets.main.java.srcDirs

dependencies {
    compile 'com.netflix.archaius:archaius-core:0.5.8'
    compile 'commons-collections:commons-collections:3.2.1'
    compile 'com.google.inject.extensions:guice-servlet:3.0'
    compile 'com.sun.jersey.contribs:jersey-guice:1.11'
    compile 'com.netflix.servo:servo-core:0.4.34'
    compile 'com.netflix.karyon:karyon-extensions:1.0.22'
    compile 'commons-httpclient:commons-httpclient:3.1'
    compile 'javax.mail:mail:1.4.1'
    compile 'com.googlecode.json-simple:json-simple:1.1'

    runtime 'org.apache.derby:derby:10.2.2.0'
    runtime 'mysql:mysql-connector-java:5.1.16'
    runtime 'com.mchange:c3p0:0.9.2'
    runtime 'com.mchange:mchange-commons-java:0.2.3.3'

    provided 'javax.servlet:servlet-api:2.5'
}

task enhance << {
    ant.taskdef(
        name      : 'openjpaenhancer',
        classpath : project.runtimeClasspath.asPath,
        classname : 'org.apache.openjpa.ant.PCEnhancerTask'
    )

    ant.openjpaenhancer(
        classpath : project.runtimeClasspath.asPath)
}

jar {
    it.dependsOn enhance
}

test {
    it.dependsOn enhance
}

clean {
    delete 'genie-db'
    delete 'derby.log'
}
